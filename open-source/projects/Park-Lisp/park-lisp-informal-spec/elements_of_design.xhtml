<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>Elements of Design</title><link rel="stylesheet" type="text/css" href="docbook.css"/><link rel="stylesheet" type="text/css" href="style.css"/><meta name="generator" content="DocBook XSL Shlomif"/><link rel="prev" href="what_park_is_based_on.xhtml" title="What Park is based on"/></head><body><header><div class="center ads_top"/><div class="navheader"><table style="width:100%"><tr><th style="text-align:center" colspan="3">Elements of Design</th></tr><tr><td style="width:20%;text-align:left"><a accesskey="p" href="what_park_is_based_on.xhtml">Prev</a> </td><th style="width:60%;text-align:center"> </th><td style="width:20%;text-align:right"> </td></tr></table><hr/></div></header><section class="section"><div class="titlepage"><div><div><h2 id="elements_of_design" class="title">Elements of Design</h2></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="elements_of_design.xhtml#arc_is_object_oriented">Arc is Object Oriented (Everything is an Object)</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#lexical_scoping_and_dynamic_scoping">Lexical Scoping and Dynamic Scoping</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#full_posix_conventions">Park would be Fully POSIX</a></span><ul><li><span class="section"><a href="elements_of_design.xhtml#monads_for_files">Thoughts about using Monads for Files</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#bootstrapping_self_hosting_and_c_hosting">Bootstrapping, Self Hosting and C Hosting</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#constants_in_park">Constants in Park</a></span><ul><li><span class="section"><a href="elements_of_design.xhtml#strings_quoting_and_interpolation">Strings, Quoting and Interpolation</a></span><ul><li><span class="section"><a href="elements_of_design.xhtml#string_constants">String Constants</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#string_interpolation">String Interpolation</a></span></li></ul></li></ul></li></ul></li></ul></div><section class="section"><div class="titlepage"><div><div><h3 id="arc_is_object_oriented" class="title">Arc is Object Oriented (Everything is an Object)</h3></div></div></div><p>Paul Graham wrote <a class="link" href="http://www.paulgraham.com/noop.html">Why Arc isn't Especially Object-Oriented.</a>. His conclusion for why this is the case are:</p><div class="blockquote"><blockquote class="blockquote"><p>I personally have never needed object-oriented abstractions. Common Lisp has an enormously powerful object system and I've never used it once. I've done a lot of things (e.g. making hash tables full of closures) that would have required object-oriented techniques to do in wimpier languages, but I have never had to use CLOS.</p><p>Maybe I'm just stupid, or have worked on some limited subset of applications. There is a danger in designing a language based on one's own experience of programming. But it seems more dangerous to put stuff in that you've never needed because it's thought to be a good idea.</p></blockquote></div><p>Well, maybe it's because I'm younger, but having worked with Perl 5 extensively, I've used its object system (and some OO-support modules) a lot. While I have inherited some classes in Perl 5, I also often use an object just to make sure it can be instantiated.</p><p>Furthermore, having learned a bit about Perl 6 and Ruby, I believe that making everything an object, can be advantageous because one can more easily inherit from it, and add methods (and multimethods) to constants or regular variables (e.g: <span class="quote">“<span class="quote">6-&gt;my_func();</span>”</span>), or even easily override default behaviour.</p><p>So there we go. Note that Park will not be overly-Object-Oriented (OOO). One would be able to declare global functions and variables, and write scripts or modules without wrapping it in Objects. (Read what <a class="link" href="http://www.builderau.com.au/program/0,39024614,39160082,00.htm">Damian Conway has to say about the Hello World program in Java</a> for why I don't like it).</p><p>Here are some features of the object system:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Supports multiple-inheritance.</p></li><li class="listitem"><p>Methods can be added to classes at run-time (like Smalltalk or Ruby).</p></li><li class="listitem"><p>Supports <a class="link" href="http://use.perl.org/~Ovid/journal/27656">traits</a> (or as the Perl 6 people call them "Roles").</p></li><li class="listitem"><p>The fields of every object will be stored as an associative array, accessible using a special method. (This associative array will also be an object since everything is. I wonder how the Python people have solved it, but it's probably doable.)</p></li><li class="listitem"><p>The member variables of every object will be stored as an associative array, accessible using a special method. (This associative array will also be an object since everything is. I wonder how the Python people have solved it, but it's probably doable.)</p></li><li class="listitem"><p>Similarly to Perl5 and Python (and as opposed to Java, C++ or PHP) there won't be any built-in "public", "protected", "private", etc. access-control for methods of objects by default. Such things can probably be implemented by tweaking the method class and/or the class meta-class, or in different ways completely, but I don't find it appropriate for Park.</p></li><li class="listitem"><p>Multi-methods will be supported. Multimethods are functions that are dispatched according to more than one object based on the best matching multimethod signature. The syntax for this would be the mcall function (short for multi-call):</p><pre class="programlisting">
(mcall my-multi-method ([ object1 object2 object3])
    optional-param1 optional-param2 optional-param3
)
</pre><p>The standard way to invoke a method is to use the <code class="literal">call</code> function, which propagates according to only a single argument:</p><pre class="programlisting">
(def-method "MyClass::init"
    ((this)
        (set (this sum) 0)
    )
)
(def-method "MyClass::add"
    ((this n)
        (+= (-&gt; this sum) n)
    )
)
(def-method "MyClass::getsum"
    ((this)
        (-&gt; this sum)
    )
)
(set new-summer (new MyClass))
(call add new-summer 5)
(call add new-summer 7)
(call add new-summer 13)
(print (call getsum new-summer) "\n")
</pre><p>This will print 24 and a newline.</p><p>Note that usually the call would be redundant, and you could use a simple function call. However, such a function call would be subject to other Perl 5-like calling semantics.</p></li></ol></div></section><section class="section"><div class="titlepage"><div><div><h3 id="lexical_scoping_and_dynamic_scoping" class="title">Lexical Scoping and Dynamic Scoping</h3></div></div></div><p>Scheme and Common Lisp which are the most modern popular LISP dialects use lexical scoping, and since Perl 5 adopted it, it has been become very popular and mainstream, outside Lisp.</p><p>The default localization of values in Park would be lexical. However, having used Perl 5's <code class="literal">local</code>, I am aware of <a class="link" href="http://perl.plover.com/local.html">several good uses for dynamic scoping in a mostly lexical scoping language</a>. So, there will be a way to localise variables dynamically in Park.</p><p>One killer feature like that would be a way to do something like:</p><pre class="programlisting">
(do-using-local-state
    (
        (set a "hello")
        (my-func-with-side-effects)
    )
    (
        # Rest of code here.
    )
)
# a is no longer hello and (my-func-with-side-effects) effects' are reversed.
</pre><p>Of course, this feature is still pie-in-the-sky, and I'm waiting for a good analysis of complexity and/or efficient working implementation.</p></section><section class="section"><div class="titlepage"><div><div><h3 id="full_posix_conventions" class="title">Park would be Fully POSIX</h3></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="elements_of_design.xhtml#monads_for_files">Thoughts about using Monads for Files</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#bootstrapping_self_hosting_and_c_hosting">Bootstrapping, Self Hosting and C Hosting</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#constants_in_park">Constants in Park</a></span><ul><li><span class="section"><a href="elements_of_design.xhtml#strings_quoting_and_interpolation">Strings, Quoting and Interpolation</a></span><ul><li><span class="section"><a href="elements_of_design.xhtml#string_constants">String Constants</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#string_interpolation">String Interpolation</a></span></li></ul></li></ul></li></ul></div><p>Park will be expected to run on a Unix or a Unix-like system (such as Win32) and will provide APIs for such common POSIX and P-Languages operations as random file I/O, sockets, regular expressions, manipulating ASCII text, Unicode and other encodings. It may also have platform-specific modules for managing processes, creating new processes, etc. (as is the case for Perl 5, for example.)</p><p>All of these things will eventually be part of the Park spec, and their APIs would be common to all implementations.</p><section class="section"><div class="titlepage"><div><div><h4 id="monads_for_files" class="title">Thoughts about using Monads for Files</h4></div></div></div><div class="blockquote"><table style="border:0" class="blockquote"><tr><td style="width:10%;vertical-align:top"> </td><td style="width:80%;vertical-align:top"><p>I understood Monads for exactly 5 minutes. Then the understanding left my head. It was too hard for me to keep there.</p></td><td style="width:10%;vertical-align:top"> </td></tr><tr><td style="width:10%;vertical-align:top"> </td><td style="text-align:right;vertical-align:top" colspan="2">--<span class="attribution"> An anonymous Perl 5 and <a class="link" href="https://en.wikipedia.org/wiki/Pugs_(programming)">Pugs</a> hacker about Haskell's Monads.</span></td></tr></table></div><p>As cool as Monads are I'm skeptical about using them in files by default. I know how to use File I/O in Haskell, but still don't understand when Monads are needed. My personal Haskell style so far made no use of them except for file Input and Output.</p><p>One will be able to implement Monads in Park and use them for file I/O. There may even be a default Monad class. However, the default file Input/Output API will either be a reflection of the POSIX one, or alternatively something similar in spirit to <a class="link" href="http://search.cpan.org/search?query=perlio&amp;mode=module">PerlIO</a> or the Python or Ruby files and sockets I/O classes.</p><p>Above this API one can build as many abstractions to his liking, including Monads.</p></section><section class="section"><div class="titlepage"><div><div><h4 id="bootstrapping_self_hosting_and_c_hosting" class="title">Bootstrapping, Self Hosting and C Hosting</h4></div></div></div><p>Bootstrapping is the process of implementing a virtual machine by implementing it using an existing virtual machine. So, for example perl 5, CPython, ruby, php and the Tcl interpreter are all written in C. That way they can be bootstrapped to run on any system for which a C compiler (such as <a class="link" href="http://gcc.gnu.org/">the Open-Source gcc</a> is available).</p><p>A related concept is Self-hosting, where a virtual machine's compiler or interpreter is written in itself. So for example, gcc is written in C and requires a C compiler to be built.</p><p>For C it is not really a problem, because one can use gcc or a different C compiler to cross-compile enough programs for it to run there conveniently. However,</p></section><section class="section"><div class="titlepage"><div><div><h4 id="constants_in_park" class="title">Constants in Park</h4></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="elements_of_design.xhtml#strings_quoting_and_interpolation">Strings, Quoting and Interpolation</a></span><ul><li><span class="section"><a href="elements_of_design.xhtml#string_constants">String Constants</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#string_interpolation">String Interpolation</a></span></li></ul></li></ul></div><div class="blockquote"><table style="border:0" class="blockquote"><tr><td style="width:10%;vertical-align:top"> </td><td style="width:80%;vertical-align:top"><p>"I am not in Rome."</p></td><td style="width:10%;vertical-align:top"> </td></tr><tr><td style="width:10%;vertical-align:top"> </td><td style="text-align:right;vertical-align:top" colspan="2">--<span class="attribution"> An anonymous designer of his own DOS 8086 Assembly written in itself, and used to write other programs, in which numbers that start with 0 are hexadecimal.</span></td></tr></table></div><p>I encountered some Scheme implementations in which identifiers were case-sensitive, and some in which they were case-insensitive. To match what is the norm nowadays, and because I like it better, Park requires case-sensitive identifiers.</p><p>Numbers in Park can be decimal, octal (if they start with "0"), or hexadecimal (if they start with 0x). Following Perl's lead, one will be able to use underscores (<code class="literal">_</code>) within numbers (e.g: <code class="literal">100_000</code> instead of <code class="literal">100000</code>).</p><section class="section"><div class="titlepage"><div><div><h5 id="strings_quoting_and_interpolation" class="title">Strings, Quoting and Interpolation</h5></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="elements_of_design.xhtml#string_constants">String Constants</a></span></li><li><span class="section"><a href="elements_of_design.xhtml#string_interpolation">String Interpolation</a></span></li></ul></div><section class="section"><div class="titlepage"><div><div><h6 id="string_constants" class="title">String Constants</h6></div></div></div><p>String constants will be written in a large correspondence to the C, Perl 5 and Perl 6 conventions. For example, a "\n" will designate a newline. The exact type and quoting of the string will be determined by a few optional Perl 6-like modifiers. Here are a few examples:</p><pre class="programlisting">
# The (qq ... ) is not really needed but it doesn't hurt.
(my mystring (qq "Hello there, Hackers! Welcome to Park"))
(print mystring "\n")
(my regex (m :p5 "H..kers"))
(say (=~ mystring regex)) # Prints "Hackers"
(my conv (tr "H" "B"))
(say (=~ mystring conv)) # Prints "Bello there, Backers!..."
(my newstring mystring)
(=~! newstring conv)
# newstring is now "Bello there, Backers!..."
# (You gotta love S-expressions.)
</pre></section><section class="section"><div class="titlepage"><div><div><h6 id="string_interpolation" class="title">String Interpolation</h6></div></div></div><p>There was a very interesting presentation in an <a class="link" href="http://www.perl.org.il/">Israeli Perl Mongers meeting</a> about strings, quoting and interpolation in other languages and Perl. The presentation noted among else that in other languages one has to write relatively ugly code like <code class="literal">"Hello" &amp; Name &amp; "! What's up?"</code> rather than the Perl <code class="literal">"Hello $Name! What's up?"</code>.</p><p>In Perl 5 the interpreter has some heuristics for determining the end of the interpolated expression, which can be any arbitrary Perl expression. Perl 6 goes one step further and parses the string and translates it into Perl 6 code, so one can safely include arbitrarily complex code there. (In a similar fashion to the Korn shell "$(...)" construct).</p><p>What I plan is to have such interpolation in Park as well for some types of strings. The syntax will look something like that:</p><pre class="programlisting">
(my i 5 j 7)
(print "${i} + ${j} = $(+ i j)\n")
</pre><p>As expected this prints "5 + 7 = 12" (followed by a newline).</p><p>Another thing I'd like to have is shell or Perl 5-like here documents (<code class="literal">&amp;&amp;"EOF" ... EOF</code>)</p></section></section></section></section></section><footer><div class="navfooter"><hr/><table style="width:100%"><tr><td style="width:40%;text-align:left"><a accesskey="p" href="what_park_is_based_on.xhtml">Prev</a> </td><td style="width:20%;text-align:center"> </td><td style="width:40%;text-align:right"> </td></tr><tr><td style="width:40%;text-align:left;vertical-align:top">What Park is based on </td><td style="width:20%;text-align:center"><a accesskey="h" href="index.xhtml">Home</a></td><td style="width:40%;text-align:right;vertical-align:top"> </td></tr></table></div></footer></body></html>